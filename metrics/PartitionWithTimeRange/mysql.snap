
[TestMetricsSuite/TestPartitionWithTimeRange - 1]
select
  DATEADD(DAY, 1, STR_TO_DATE(DATE_FORMAT(ingested_at, '%Y-%m-%d 00:00:00'), '%Y-%m-%d %H:%i:%s')) as time_segment, 
  'run_type' as field, 
  count(*) as num_rows, 
  COALESCE(count(run_type), 0) as num_not_null, 
  COALESCE(count(distinct run_type), 0) as num_unique, 
  COALESCE(SUM(CASE WHEN %s THEN 1 ELSE 0 END)(run_type = 0), 0) as num_empty, 
  CAST(COALESCE(avg(run_type), 0) AS FLOAT) as mean, 
  CAST(COALESCE(min(run_type), 0) AS FLOAT) as min, 
  CAST(COALESCE(max(run_type), 0) AS FLOAT) as max, 
  CAST(COALESCE(MEDIAN(run_type), 0) AS FLOAT) as median, 
  CAST(COALESCE(STDDEV(run_type), 0) AS FLOAT) as stddev
from default.runs 
where
  ingested_at >= '2025-01-01T00:00:00Z' and 
  ingested_at < '2025-02-01T00:00:00Z'
group by DATEADD(DAY, 1, STR_TO_DATE(DATE_FORMAT(ingested_at, '%Y-%m-%d 00:00:00'), '%Y-%m-%d %H:%i:%s'))
order by DATEADD(DAY, 1, STR_TO_DATE(DATE_FORMAT(ingested_at, '%Y-%m-%d 00:00:00'), '%Y-%m-%d %H:%i:%s')) 
---
