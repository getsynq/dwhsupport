
[TestMetricsSuite/TestPartitionWithTimeRange - 1]
select
  TIMESTAMP_ADD(timestamp_trunc(timestamp(ingested_at), DAY), INTERVAL 1 DAY) as time_segment, 
  'run_type' as field, 
  count(*) as num_rows, 
  COALESCE(count(run_type), 0) as num_not_null, 
  COALESCE(count(distinct run_type), 0) as num_unique, 
  COALESCE(countif(run_type = 0), 0) as num_empty, 
  CAST(COALESCE(avg(run_type), 0) AS FLOAT64) as mean, 
  CAST(COALESCE(min(run_type), 0) AS FLOAT64) as min, 
  CAST(COALESCE(max(run_type), 0) AS FLOAT64) as max, 
  CAST(COALESCE(approx_quantiles(run_type, 2)[offset(1)], 0) AS FLOAT64) as median, 
  CAST(COALESCE(stddev_samp(run_type), 0) AS FLOAT64) as stddev
from `db.default.runs` 
where
  timestamp(ingested_at) >= timestamp '2025-01-01T00:00:00Z' and 
  timestamp(ingested_at) < timestamp '2025-02-01T00:00:00Z'
group by TIMESTAMP_ADD(timestamp_trunc(timestamp(ingested_at), DAY), INTERVAL 1 DAY)
order by TIMESTAMP_ADD(timestamp_trunc(timestamp(ingested_at), DAY), INTERVAL 1 DAY) 
---
